# PIT-4 : VELLA_V7 APP ORCHESTRATOR RULES

## 목적
이 문서는 V7에서 **app(오케스트레이터)** 가
무엇을 **할 수 있고**, 무엇을 **절대 못 하는지**를 고정한다.

app이 똑똑해지는 순간,
V7은 다시 V3으로 퇴행한다.


============================================================
## 0. 최상위 선언
============================================================

- app은 **판단 주체가 아니다**
- app은 **계산하지 않는다**
- app은 **의미를 해석하지 않는다**

👉 app의 유일한 역할은:
**Event를 받아 → 순서를 보장 → 다음 모듈로 전달**


============================================================
## 1. app의 정체성
============================================================

[비유]
- entry / exit / risk  = 연주자
- execution            = 악기
- state                = 녹음기
- **app                = 지휘자**

지휘자는:
- 악보를 해석 ❌
- 연주를 대신 ❌
- 음을 바꾸지 ❌

오직 **언제 누구를 부를지**만 안다.


============================================================
## 2. app이 가질 수 있는 능력 (허용)
============================================================

✔ Event 수집
✔ Event 전달
✔ Event 순서 제어
✔ Event 존재 여부 확인 (있다 / 없다)

[예]
- EntrySignal이 없으면 risk를 호출하지 않는다
- ExitSignal이 있으면 entry는 호출하지 않는다

※ 조건 분기 ≠ 판단  
→ **“있으면 전달 / 없으면 중단”만 허용**


============================================================
## 3. app이 절대 하면 안 되는 것 (금지)
============================================================

❌ 전략 판단
❌ 수치 계산
❌ 조건 최적화
❌ 신호 생성
❌ state 수정
❌ execution 결과 해석

[위반 예]
- “지금은 위험하니까 진입 안 하자” ❌
- “슬리피지가 커서 취소하자” ❌
- “이전 손실이 커서 비중 줄이자” ❌

→ 이런 생각이 들면 **모듈이 잘못 설계된 것**이다.


============================================================
## 4. app의 입력과 출력
============================================================

[입력]
- ContextSnapshot
- EntrySignal (optional)
- ExitSignal (optional)
- RiskProfile (optional)
- ExecutionResult (execution에서 반환되는 사실)

[출력]
- 다음 모듈로 전달되는 Event
- state 기록 요청

※ app은 **Event를 생성하지 않는다**


============================================================
## 5. app의 표준 실행 흐름 (V7 고정)
============================================================

1️⃣ ContextSnapshot 수신
2️⃣ EngineState 읽기 (읽기 전용)
3️⃣ entry 호출
   - EntrySignal 없으면 종료
4️⃣ risk 호출
   - RiskProfile 생성
5️⃣ execution 호출
   - ExecutionOrder 전달
6️⃣ state 기록
   - 결과를 사실로만 저장
7️⃣ 종료

※ exit 흐름도 동일 구조 (entry 대신 exit)


============================================================
## 6. app이 알아도 되는 정보의 한계
============================================================

app이 **알아도 되는 것**
- Event의 타입
- Event의 존재 여부
- 호출 순서

app이 **몰라야 하는 것**
- Event 내부 수치 의미
- 왜 이런 신호가 나왔는지
- 이 판단이 좋은지 나쁜지

👉 “이해하려는 순간 설계 위반”


============================================================
## 7. 실패 방지 강제 규칙
============================================================

아래 중 하나라도 발견되면 **즉시 삭제 대상**이다.

- if price > x:
- score +=
- confidence =
- adjust, optimize, improve 같은 단어
- heuristic, smart, adaptive 같은 개념

V7에서 app은 **멍청할수록 강하다**.


============================================================
## 8. 확장 규칙
============================================================

- app에 기능 추가 ❌
- 새로운 판단은 **항상 새 모듈**로
- app은 절대 비대해지지 않는다

확장은:
PIT 문서 → 모듈 추가 → app은 그대로


============================================================
## 9. 최종 선언
============================================================

- app은 엔진이 아니다
- app은 뇌가 아니다
- app은 조립기다

이 규칙을 지키는 한,
V7은 절대 다시 엮이지 않는다.
