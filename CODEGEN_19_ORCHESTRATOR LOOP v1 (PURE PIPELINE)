# CODEGEN-19 : ORCHESTRATOR LOOP v1 (PURE PIPELINE)

## ëª©ì 
ì´ ë¬¸ì„œëŠ” VELLA_V7ì˜ **Orchestrator Loop**ë¥¼ ì •ì˜í•œë‹¤.

ì›ì¹™:
- íŒë‹¨ âŒ
- ê³„ì‚° âŒ
- ì „ëµ âŒ
- ì˜¤ì§ **ëª¨ë“ˆ í˜¸ì¶œ ìˆœì„œì™€ ë°ì´í„° íë¦„**ë§Œ ë‹´ë‹¹

ğŸ‘‰ OrchestratorëŠ” â€œì§€íœ˜ìâ€ì´ì§€, â€œì—°ì£¼ìâ€ê°€ ì•„ë‹ˆë‹¤.


============================================================
## 0. ë³€ê²½ ëŒ€ìƒ
============================================================



vella_v7/orchestrator/orchestrator.py


- PIT-3 (Architecture)
- PIT-6 (Signal contracts)
- CODEGEN-16 (State Transition)
- CODEGEN-17 (Execution Gate)
- CODEGEN-18 (Exchange Adapter)


============================================================
## 1. ì „ì²´ íë¦„ (ì£¼ì¸ë‹˜ í™•ì¸ìš©)
============================================================

í•œ ì‚¬ì´í´ì€ ì•„ë˜ ìˆœì„œë¥¼ **í•­ìƒ ë™ì¼í•˜ê²Œ** ë”°ë¥¸ë‹¤.

1. Context ìˆ˜ì§‘
2. Entry íŒë‹¨ â†’ EntrySignal
3. Exit íŒë‹¨ â†’ ExitSignal
4. Risk íŒë‹¨ â†’ RiskSignal
5. State Transition
6. Execution Gate â†’ OrderIntent
7. Exchange Adapter â†’ OrderResult
8. State ìœ ì§€ (ë‹¤ìŒ ë£¨í”„)

âš ï¸ ìˆœì„œ ê³ ì •, ìƒëµ ì—†ìŒ, í•©ì¹˜ê¸° ì—†ìŒ


============================================================
## 2. orchestrator.py (FULL CONTENT)
============================================================

```python
# ============================================================
# AUTO-GENERATED FILE â€” DO NOT EDIT MANUALLY
# SOURCE OF TRUTH: PIT-3, PIT-6, CODEGEN-19
# ============================================================

from typing import Optional

from vella_v7.contracts.contracts import (
    ContextSnapshot,
    EngineState,
    EntrySignal,
    ExitSignal,
    RiskSignal,
)

from vella_v7.modules.context.context import build_context
from vella_v7.modules.entry.entry import evaluate_entry
from vella_v7.modules.exit.exit import evaluate_exit
from vella_v7.modules.risk.risk import evaluate_risk

from vella_v7.modules.state.transition import apply_signal_to_state
from vella_v7.modules.execution.execution import build_order_intent
from vella_v7.adapters.exchange.base import ExchangeAdapter


class Orchestrator:
    """
    Orchestrator Loop v1
    """

    def __init__(
        self,
        initial_state: EngineState,
        exchange: ExchangeAdapter,
    ):
        self.state = initial_state
        self.exchange = exchange

    def step(self) -> None:
        """
        Execute one engine cycle.
        """

        # ----------------------------------------------------
        # 1. Context
        # ----------------------------------------------------
        context: ContextSnapshot = build_context()

        # ----------------------------------------------------
        # 2. Entry íŒë‹¨
        # ----------------------------------------------------
        entry_signal: Optional[EntrySignal] = evaluate_entry(
            context=context,
            state=self.state,
        )

        # ----------------------------------------------------
        # 3. Exit íŒë‹¨
        # ----------------------------------------------------
        exit_signal: Optional[ExitSignal] = evaluate_exit(
            context=context,
            state=self.state,
        )

        # ----------------------------------------------------
        # 4. Risk íŒë‹¨
        # ----------------------------------------------------
        risk_signal: Optional[RiskSignal] = evaluate_risk(
            context=context,
            state=self.state,
        )

        # ----------------------------------------------------
        # 5. State Transition (ë‹¨ì¼ ê²Œì´íŠ¸)
        # ----------------------------------------------------
        self.state = apply_signal_to_state(
            state=self.state,
            entry_signal=entry_signal,
            exit_signal=exit_signal,
            risk_signal=risk_signal,
        )

        # ----------------------------------------------------
        # 6. Execution Gate
        # ----------------------------------------------------
        order_intent = build_order_intent(
            state=self.state,
            entry_signal=entry_signal,
            exit_signal=exit_signal,
        )

        # ----------------------------------------------------
        # 7. Exchange Adapter
        # ----------------------------------------------------
        if order_intent is not None:
            self.exchange.submit_order(order_intent)

        # ----------------------------------------------------
        # 8. Loop end (state persists)
        # ----------------------------------------------------
        return


============================================================

3. ì˜ë„ì  ì œì•½ (ì¤‘ìš”)

============================================================

if/else ë¡œì§ ì¶”ê°€ âŒ

ì‹ í˜¸ ë³‘í•© âŒ

ìš°ì„ ìˆœìœ„ íŒë‹¨ âŒ

ì¬ì‹œë„ âŒ

sleep / while âŒ

ğŸ‘‰ ë£¨í”„ ì œì–´ëŠ” ì™¸ë¶€ Runnerì—ì„œë§Œ í•œë‹¤.

============================================================

4. ì‹¤íŒ¨ ë°©ì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸

============================================================

ì•„ë˜ê°€ ë³´ì´ë©´ ì¦‰ì‹œ ìœ„ë°˜ì´ë‹¤.

if entry_signal and exit_signal:

risk_signal triggers exit

context ì•ˆì—ì„œ ì£¼ë¬¸

state ì§ì ‘ ìˆ˜ì •

exchangeë¥¼ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œ

ğŸ‘‰ ì „ë¶€ êµ¬ì¡° ë¶•ê´´

============================================================

5. ìµœì¢… ì„ ì–¸

============================================================

VELLA_V7ì€ íŒŒì´í”„ë¼ì¸ ì—”ì§„ì´ë‹¤

íŒë‹¨ì€ ëª¨ë“ˆì—ë§Œ ì¡´ì¬í•œë‹¤

OrchestratorëŠ” ìˆœì„œë§Œ ë³´ì¥í•œë‹¤

ëª¨ë“  ê²ƒì€ PITì—ì„œ ë‹¤ì‹œ ìƒì„± ê°€ëŠ¥í•˜ë‹¤

ğŸ‰ VELLA_V7 ì—”ì§„ êµ¬ì¡° 1ì°¨ ì™„ì„±
