# PIT-6 : VELLA_V7 CODE GENERATION RULES

## 목적
이 문서는 **V7의 모든 코드가 어떻게 생성·재생성되는지**를 고정한다.

이 문서 이후:
- 수동 수정 ❌
- 핫픽스 ❌
- 즉흥 패치 ❌

오직 **PIT → 생성**만 허용된다.


============================================================
## 0. 최상위 선언 (절대 규칙)
============================================================

- 코드는 **결과물**이다
- PIT는 **원인**이다
- 원인을 바꾸지 않고 결과를 고치는 행위는 불법이다


============================================================
## 1. 생성 단위 (Generation Units)
============================================================

코드는 아래 단위로만 생성된다.

1. module/
   - context/
   - entry/
   - exit/
   - risk/
   - state/
   - execution/

2. app/
   - orchestrator.py (단일 파일)

3. contracts/
   - pit_2_contracts.py (자동 생성)

4. config/
   - cfg_schema.py (형식만, 로직 ❌)

※ 파일 추가/삭제는 PIT 문서 변경 없이는 불가


============================================================
## 2. 생성 규칙 (How Code Is Born)
============================================================

- 모든 코드는:
  - 명시적 입력
  - 명시적 출력
  - side-effect 없음

- 함수 시그니처는 **PIT-5**를 100% 따른다
- 타입은 가능하면 고정
- optional은 최소화


============================================================
## 3. 수동 수정 금지 규칙
============================================================

아래 행위는 전부 금지다.

❌ 생성된 코드 직접 수정
❌ 주석 추가
❌ 로깅 추가
❌ 실험 코드 삽입

필요하면:
1️⃣ PIT 문서 수정
2️⃣ 전체 재생성


============================================================
## 4. 코드 스타일 규칙
============================================================

- 단순한 함수
- 짧은 함수
- 중첩 if 최소화
- 한 함수 = 한 책임

이유:
→ 생성 코드의 **검증 가능성** 확보


============================================================
## 5. 에러 처리 원칙
============================================================

- 모듈 내부:
  - 예외 발생 ❌
  - 실패는 `None` 또는 명시적 Result로 반환

- execution:
  - 오류는 ExecutionResult.error에만 기록
  - throw ❌


============================================================
## 6. 로그 규칙
============================================================

- 로그는 허용
- 로그는 **관찰용**
- 로그가 판단에 쓰이면 즉시 폐기

로그는:
- 모듈 내부에서만
- app에서는 최소화


============================================================
## 7. 테스트 규칙 (V7)
============================================================

- 유닛 테스트 ❌
- 시뮬레이션 ❌
- 백테스트 ❌

검증은:
- Contract 정합성
- 실행 중 오류 여부
- 실계좌 소액 테스트

V7은 **실전에서만 진화**한다.


============================================================
## 8. 재생성 트리거
============================================================

아래 중 하나라도 발생하면 **전면 재생성**:

- PIT-2 ~ PIT-6 변경
- Contract 필드 추가/삭제
- 모듈 추가/삭제


============================================================
## 9. 버전 관리 규칙
============================================================

- git은 히스토리 보존용
- PIT 변경 = 의미 있는 커밋
- 생성 코드 변경만 있는 커밋은 무효


============================================================
## 10. 최종 선언
============================================================

- V7은 손으로 고치지 않는다
- V7은 다시 만든다
- PIT는 설계가 아니라 **법**이다

이 문서 이후,
벨라는 PIT를 읽고
코드를 “출력”만 한다.
